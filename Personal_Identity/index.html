<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finnish Personal Identity Code Validator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
            width: auto;
        }


        button:hover {
            background: #5568d3;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .result.valid {
            display: block;
        }

        .result.invalid {
            background: #f8d7da;
            border: 2px solid #dc3545;
            display: block;
        }

        .result h3 {
            margin-bottom: 15px;
        }

        .result.valid h3 {
            color: #155724;
        }

        .result.invalid h3 {
            color: #721c24;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Personal Identity Code</h1>
        <p class="subtitle">Validator & Generator</p>

        <!-- Validation Section -->
        <div class="section">
            <h2>Validate Personal Identity Code</h2>
            
            <div class="format-help">
                <strong>Format:</strong> <code>DDMMYYCZZZQ</code><br>
                • C = Century (+: 1800s, -: 1900s, A: 2000s)<br>
                • ZZZ = Individual number (001-899, odd=male, even=female)<br>
                • Q = Control character
            </div>

            <div class="input-group">
                <label for="idCode">Personal Identity Code:</label>
                <input type="text" id="idCode" placeholder="e.g., 010190-123A" maxlength="11">
            </div>

            <div class="input-group">
                <label>Your Gender:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="gender" value="M" checked>
                        Male
                    </label>
                    <label>
                        <input type="radio" name="gender" value="F">
                        Female
                    </label>
                </div>
            </div>

            <button onclick="validateCode()">Validate Code</button>

            <div id="validationResult" class="result"></div>
        </div>

        <!-- Generator Section -->
        <div class="section">
            <h2>Personal Identity Code Generator</h2>

            <div class="input-group">
                <label for="birthDate">Birth Date:</label>
                <input type="date" id="birthDate">
            </div>

            <div class="input-group">
                <label>Gender:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="genGender" value="M" checked>
                        Male
                    </label>
                    <label>
                        <input type="radio" name="genGender" value="F">
                        Female
                    </label>
                </div>
            </div>

            <button onclick="generateCode()">Generate Code</button>

            <div id="generatedCode"></div>
        </div>
    </div>

    <script>

        const CONTROL_CHARS = "0123456789ABCDEFHJKLMNPRSTUVWXY";

        function calculateControlChar(digits) {
            const number = parseInt(digits, 10);
            const remainder = number % 31;
            return CONTROL_CHARS[remainder];
        }

        function getCenturySign(year) {
            if (year >= 2000 && year <= 2099) return 'A';
            if (year >= 1900 && year <= 1999) return '-';
            if (year >= 1800 && year <= 1899) return '+';
            return null;
        }

        function getFullYear(yy, centurySign) {
            const yearNum = parseInt(yy, 10);
            if (centurySign === '+') return 1800 + yearNum;
            if (centurySign === '-') return 1900 + yearNum;
            if (centurySign === 'A') return 2000 + yearNum;
            return null;
        }

        function isValidDate(day, month, year) {
            const date = new Date(year, month - 1, day);
            return date.getFullYear() === year && 
                   date.getMonth() === month - 1 && 
                   date.getDate() === day;
        }

        function calculateAge(birthDate) {
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        function validateCode() {
            const code = document.getElementById('idCode').value.trim().toUpperCase();
            const selectedGender = document.querySelector('input[name="gender"]:checked').value;
            const resultDiv = document.getElementById('validationResult');

            if (code.length !== 11) {
                resultDiv.className = 'result invalid';
                resultDiv.innerHTML = '<h3>Invalid Format</h3><p>Personal identity code must be 11 characters long.</p>';
                return;
            }

            const dd = code.substring(0, 2);
            const mm = code.substring(2, 4);
            const yy = code.substring(4, 6);
            const centurySign = code[6];
            const zzz = code.substring(7, 10);
            const controlChar = code[10];

            if (!['+', '-', 'A'].includes(centurySign)) {
                resultDiv.className = 'result invalid';
                resultDiv.innerHTML = '<h3>Invalid Century Sign</h3><p>Century sign must be + (1800s), - (1900s), or A (2000s).</p>';
                return;
            }

            const fullYear = getFullYear(yy, centurySign);
            const day = parseInt(dd, 10);
            const month = parseInt(mm, 10);

            if (!isValidDate(day, month, fullYear)) {
                resultDiv.className = 'result invalid';
                resultDiv.innerHTML = '<h3>Invalid Date</h3><p>The birth date is not valid.</p>';
                return;
            }

            //validate number range
            const individualNum = parseInt(zzz, 10);
            if (individualNum < 1 || individualNum > 899) {
                resultDiv.className = 'result invalid';
                resultDiv.innerHTML = '<h3>Invalid Individual Number</h3><p>Individual number must be between 001 and 899.</p>';
                return;
            }

            //check character
            const expectedControl = calculateControlChar(dd + mm + yy + zzz);
            if (controlChar !== expectedControl) {
                resultDiv.className = 'result invalid';
                resultDiv.innerHTML = `<h3>Invalid Control Character</h3><p>Expected: ${expectedControl}, Got: ${controlChar}</p>`;
                return;
            }

            //gender determine
            const codeGender = (individualNum % 2 === 1) ? 'M' : 'F';
            const genderMatch = codeGender === selectedGender;

            //age
            const birthDate = new Date(fullYear, month - 1, day);
            const age = calculateAge(birthDate);

            //display
            const centuryName = centurySign === '+' ? '1800s' : centurySign === '-' ? '1900s' : '2000s';
            const genderName = codeGender === 'M' ? 'Male' : 'Female';

            let html = `<h3>Valid Personal Identity Code</h3>`;
            html += `<div class="result-item"><strong>Birth Date:</strong> ${dd}.${mm}.${fullYear}</div>`;
            html += `<div class="result-item"><strong>Age:</strong> ${age} years old</div>`;
            html += `<div class="result-item"><strong>Gender (from code):</strong> ${genderName}</div>`;
            html += `<div class="result-item"><strong>Century:</strong> ${centuryName}</div>`;
            html += `<div class="result-item"><strong>Individual Number:</strong> ${zzz} (${individualNum % 2 === 1 ? 'Odd' : 'Even'})</div>`;
            html += `<div class="result-item"><strong>Control Character:</strong> ${controlChar}</div>`;

            if (!genderMatch) {
                html += `<div class="result-item" style="background: #fff3cd; border: 1px solid #ffc107;">
                    <strong>Gender Mismatch:</strong> The code indicates ${genderName}, but you selected ${selectedGender === 'M' ? 'Male' : 'Female'}.
                </div>`;
            }

            resultDiv.className = 'result valid';
            resultDiv.innerHTML = html;
        }


        function generateCode() {
            const birthDateInput = document.getElementById('birthDate').value;
            const gender = document.querySelector('input[name="genGender"]:checked').value;
            const resultDiv = document.getElementById('generatedCode');

            if (!birthDateInput) {
                resultDiv.innerHTML = '<div class="result invalid"><h3>Error</h3><p>Please select a birth date.</p></div>';
                return;
            }

            const birthDate = new Date(birthDateInput);
            const year = birthDate.getFullYear();
            const month = birthDate.getMonth() + 1;
            const day = birthDate.getDate();

            //century sign
            const centurySign = getCenturySign(year);
            if (!centurySign) {
                resultDiv.innerHTML = '<div class="result invalid"><h3>Error</h3><p>Year must be between 1800 and 2099.</p></div>';
                return;
            }

            //date components
            const dd = String(day).padStart(2, '0');
            const mm = String(month).padStart(2, '0');
            const yy = String(year % 100).padStart(2, '0');

            let individualNum;
            if (gender === 'M') {
                //random odd number between 1 and 899
                individualNum = Math.floor(Math.random() * 450) * 2 + 1;
            } else {
                //random even number between 2 and 898
                individualNum = Math.floor(Math.random() * 449) * 2 + 2;
            }

            const zzz = String(individualNum).padStart(3, '0');

            //calculate character
            const controlChar = calculateControlChar(dd + mm + yy + zzz);

            //complete code
            const personalCode = `${dd}${mm}${yy}${centurySign}${zzz}${controlChar}`;

            //display
            const age = calculateAge(birthDate);
            const genderName = gender === 'M' ? 'Male' : 'Female';

            let html = '<div class="result valid">';
            html += '<h3>Generated Personal Identity Code</h3>';
            html += `<div class="generated-code">${personalCode}</div>`;
            html += `<div class="result-item"><strong>Birth Date:</strong> ${dd}.${mm}.${year}</div>`;
            html += `<div class="result-item"><strong>Age:</strong> ${age} years old</div>`;
            html += `<div class="result-item"><strong>Gender:</strong> ${genderName}</div>`;
            html += `<div class="result-item"><strong>Individual Number:</strong> ${zzz} (${individualNum % 2 === 1 ? 'Odd' : 'Even'})</div>`;
            html += `<div class="result-item"><strong>Control Character:</strong> ${controlChar}</div>`;
            html += '</div>';

            resultDiv.innerHTML = html;
        }

        document.getElementById('idCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                validateCode();
            }
        });
    </script>
</body>
</html>